<script>
const referenciasStore = defineStore("referencias", {
  state: () => ({
    numReferencias: '{{ CANTIDAD_REFS }}',
    refsValidas: 0,
    refs: [],
    estado: 'crear',
    ltParentesco: '{{ ltParentesco }}'.split(','),
    solicitudId: '{{ solicitudId }}'
  }),
  actions: {
    setReferencias() {
      if (this.estado === 'crear') {
        for (let i = 0; i < this.numReferencias; i++) {
          this.refs.push(new Referencia({}));
        }
      } else {
        // si se va a editar
      }
    },
    onSubmit() {
      // validacion de formularios
      this.refsValidas = 0;
      emitter.emit("SUBMIT_REF");

      if (this.refsValidas !== this.numReferencias) {
        alertify.notify("Complete la información por favor", "error");
        return;
      }

      // envío de datos
      const route = `/api/referencias/multiple/${this.solicitudId}`;
      const data = { referencias: this.refs }

      axios.post(route, data)
        .then((res) => {
          alertify.notify(res.data.msg, "success", 2, 
            () => {
              window.location.href = `${URL}/documentos/create/${this.solicitudId}`; 
            }
          );
        })
        .catch((error) => {
          console.error(error);
          alertify.alert("Ocurrió un error", error);
        });
    },
  }
});
</script>
