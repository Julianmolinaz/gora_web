<section class="modal" id="modal-login">
  <div class="modal__container" style="max-width: 36.6rem">
    <div class="modal__header">
      <div class="modal--close" id="btn-close">&otimes;</div>
      <img src="/imagenes/logo.png" alt="logo" class="modal__logo">
      <div class="modal__titulo">Ingresar</div>
      <div class="divider" style="--width-div: 7.8rem"></div>
    </div>
    <div class="modal__content">
      <div class="login-form">
        <form id="login-form">
          <div class="col">
            <div class="group">
              <div class="input-group">
                <input type="text" id="num_doc">
                <label for="num_doc">Número de documento</label>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="group">
              <div class="input-group">
                <input type="password" id="password">
                <a
                  href=""
                  class="material-icons-outlined input-group__icon"
                  id="showPassword"
                >
                  <span id="icon-visibility">visibility_off</span>
                </a>
                <label for="password">Contraseña</label>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="group">
              <a href="#" class="modal__link">¿Olvidó su contraseña?</a>
            </div>
          </div>
          <div class="group center">
            <button type="submit" class="bt bt__night" id="btn-ingresar">
              Ingresar
            </button>
          </div>
          <div class="group center">
            <a href="" class="modal__link">Crear cuenta</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  class ModalLogin {
    constructor() {
      this.close = document.querySelector("#btn-close");
      this.modal = document.querySelector("#modal-login");
      this.form = document.querySelector("#login-form");
      this.num_doc = document.querySelector("#num_doc");
      this.password = document.querySelector("#password");
      this.showPassword = document.querySelector("#showPassword");
      this.iconVisibility = document.querySelector("#icon-visibility");
      this.actions();    
    }

    actions() {
      this.close.addEventListener("click", () => this.show());
      this.form.addEventListener("submit", this.enviarCredenciales);
      this.showPassword.addEventListener("click", (event) => this.visiblePassword(event));
    }

    show() {
      this.modal.classList.toggle("modal--show");
      this.reset();
    }

    reset() {
      this.iconVisibility.textContent = "visibility_off";
      this.password.type = "password";

      this.password.value = "";
      this.num_doc.value = "";
    }

    enviarCredenciales(event) {
      event.preventDefault();
      const route = `${'{{URL}}'}/api/auth/login`;
      const data = {
        num_doc: this.num_doc.value,
        password: this.password.value
      }
      
      axios.post(route, data)
        .then((res) => {
          if (res.data.success) {
            alertify.notify("Su ingreso fue exitoso !!!", "success", 2, () => {
              window.location.href = `${'{{URL}}'}/cuenta`;        
            })
          } else {
            alertify.alert('Alerta =(', 'Credenciales invalidas, intente de nuevo'); 
          }
        })
        .catch( error => {
          alertify.alert(error.response.data);
        })
    }

    visiblePassword(event) {
      event.preventDefault();
      if (this.iconVisibility.textContent === "visibility") {
        this.iconVisibility.textContent = "visibility_off";
        this.password.type = "password";
      } else {
        this.iconVisibility.textContent = "visibility";
        this.password.type = "text";
      }
    }
  }

</script>

<style scoped>
  .login-form {
    display: flex; 
    flex-direction: column;
    width: 100%;
  }
</style>
