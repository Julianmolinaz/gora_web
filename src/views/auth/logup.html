<section id="modal-logup" class="modal">
  <div class="modal__container" style="max-width: 36.6rem">
    <div class="modal__header">
      <div class="modal--close" id="btn-close__logup">&otimes;</div>
      <img src="/imagenes/logo.png" alt="logo" class="modal__logo">
      <div class="modal__titulo">Registrarse</div>
      <div class="divider" style="--width-div: 7.8rem"></div>
      <div class="modal__subtitulo">
        Para continuar con el proceso es necesario que cree una cuenta
      </div>
    </div>
    <div class="modal__content">
      <div class="login-form">
        <form id="login-form">
          <div class="col">
            <div class="group">
              <div class="input-group">
                <input class="num_doc" type="text" id="num_doc-logup">
                <label for="num_doc">Número de documento *</label>
              </div>
              <span class="helper-txt">
                Ingrese su número de identificación
              </span>
            </div>
          </div>
          <div class="col">
            <div class="group">
              <div class="input-group">
                <input class="num_doc" type="tel" id="movil-logup">
                <label for="num_doc">Teléfono Celular *</label>
              </div>
              <span class="helper-txt">
                Ingrese su número celular
              </span>
            </div>
          </div>
          <div class="col-2">
            <div class="group">
              <div class="input-group">
                <input id="password-logup" type="password" />
                <label for="password">Contraseña *</label>
              </div> 
              <span class="helper-txt">Cree una nueva contraseña</span>
            </div>
            <div class="group">
              <div class="input-group">
                <input id="confirm-logup" type="password" />
                <label for="confirm">Confirmar *</label>
              </div>
              <span class="helper-txt">Confirme su contraseña</span>
            </div>
          </div>
          <div class="group center">
            <button id="btn-crear-cuenta" class="bt bt__night">Crear Cuenta</button>
          </div>
          <div class="col">
            <div class="group center">
              <a href="" class="modal__link" id="btn-in__login">Ya tengo una cuenta</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  class ModalLogup {
    constructor() {
      this.form = {
        num_doc: document.querySelector('#num_doc-logup'),
        movil : document.querySelector('#movil-logup'),
        password: document.querySelector('#password-logup'),
        confirm: document.querySelector('#confirm-logup')
      };

      this.close = document.querySelector('#btn-close__logup');
      this.modal = document.querySelector('#modal-logup');
      this.btnIngresar = document.querySelector('#btn-in__login');
      this.btnCrearCuenta = document.querySelector('#btn-crear-cuenta');
      this.actions();
    }

    actions() {
      this.close.addEventListener('click', () => this.show());

      this.btnCrearCuenta.addEventListener('click', (e) => {
        e.preventDefault();
        this.submitLogUp();
      })

      this.btnIngresar.addEventListener('click', (e) => {
        e.preventDefault();
        this.show();
        login.showModalLogin('solicitud');
      });
    }

    show() {
      this.modal.classList.toggle("modal--show");
    }

    submitLogUp() {
      const isValid = this.validations();
      if (!isValid) return false;
      axios.post('/api/users', {
        num_doc: this.form.num_doc.value,
        movil: this.form.movil.value,
        password: this.form.password.value,
        confirm: this.form.confirm.value
      })
      .then(res => {
        alertify.notify(res.data.msg, 'success', 2, () => {
          window.location.href = `${'{{URL}}'}/solicitudes/create`;
        });
      })
      .catch(error => {
        if (error.response) {
          const err = error.response.data;
          if (err.body.name == 'UniqueError') {
            alertify.alert(
              'Error',
              err.body.message + '<br>' +
              'Por favor de click en ya tengo una cuenta',
              () => {}
            );
          }
        }
      });
    }

    validations() {
      let str = '';
      if (!this.form.num_doc.value) {
        str += 'El número de documento es requerido<br>';
      }
      if (!this.form.movil.value) {
          str += 'El teléfono celular es requerido<br>';
      }
      if (!this.form.password.value) {
        str += 'La contraseña es requerida<br>';
      }
      if (!this.form.confirm.value) {
        str += 'La confirmación de la contraseña es requerida';
      }
      if (this.form.password.value !== this.form.confirm.value) {
        str += 'La confirmación de la contraseña no coincide'
      }

      if (str.length) {
        alertify.alert('Error en validación', str, () => {});
        return false;
      }
      return true;
    }

  }
</script>
